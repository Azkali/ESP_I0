/*
 * gui_handler.cpp
 *
 *  Created on: 11.06.2017
 *      Author: chegewara
 */
#include <freertos/FreeRTOS.h>
#include <freertos/task.h>
#include <math.h>
#include <Adafruit_GFX.h>
#include "gui_handler.h"

#include "bt_app_av.h"
#include "esp_avrc_api.h"



GuiHandler::GuiHandler(DISP_DESC *disp) {
	display = disp;
	x0 = 25; //display->width()/2;

	if(disp != NULL){
		y0 = display->height()/2;
	}
}

void GuiHandler::setDisplay(DISP_DESC *disp){
	display = disp;
	y0 = display->height()/2;
}


void GuiHandler::welcomeScreen() {
	display->setCursor(0, 0);
	display->setTextColor(WHITE);
	display->setTextSize(1);
	println((char*) "Wello Horld!");
	display->setCursor(0, display->getCursorY() + 8);
	display->setTextColor(YELLOW);
	display->setTextSize(1);
	println((char*) "Modularity");
	display->setCursor(0, display->getCursorY() + 9);
	display->setTextColor(YELLOW);
	display->setTextSize(1);
	println((char*) "in the palm of your hand");
	display->setCursor(0, display->getCursorY() + 10);
	display->setTextColor(YELLOW);
	display->setTextSize(1);
	println((char*) "anywhere !");
	display->setCursor(0, display->getCursorY() + 11);
	display->setTextColor(RED);
	display->setTextSize(1);
	println((char*) "ESP_I0");
	display->setCursor(0, display->getCursorY() + 13);
	display->setTextSize(1);
	display->setTextColor(BLUE);
	println((char*) "In FULL COLOR!");
	println((char*) "");	
}

static const uint8_t angular[]  = {
	// 'violet, 96x64px
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xfe, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x0f, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xe0, 0x07, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x3f, 0x00, 0x00, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x01, 0xff, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xe0, 0x0f, 0xfe, 0x80, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 
	0x7f, 0xfc, 0x80, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x01, 0xff, 0xfc, 0xc0, 0x00, 
	0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xf8, 0xc0, 0x00, 0x00, 0x07, 0xff, 0xff, 
	0xff, 0xff, 0xe0, 0x7f, 0xff, 0xf8, 0xe0, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xe1, 0xff, 
	0xff, 0xf8, 0xe0, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xe3, 0xff, 0xff, 0xf0, 0xf0, 0x00, 
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xe3, 0xff, 0xff, 0xf0, 0xf0, 0x00, 0x00, 0x07, 0xff, 0xff, 
	0xff, 0xff, 0xe1, 0xff, 0xff, 0xe0, 0xf8, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 
	0xff, 0xe0, 0xf8, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 0xff, 0xc0, 0xf8, 0x00, 
	0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 0xff, 0xc0, 0xfc, 0x00, 0x00, 0x0f, 0xff, 0xff, 
	0xff, 0xff, 0xf1, 0xff, 0xff, 0x80, 0x7c, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 
	0xff, 0x81, 0x7e, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 0xff, 0x81, 0x3e, 0x00, 
	0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff, 0xff, 0x03, 0x3f, 0x00, 0x00, 0x0f, 0xff, 0xff, 
	0xff, 0xff, 0xf1, 0xff, 0xff, 0x03, 0x3f, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 
	0xfe, 0x07, 0x1f, 0x80, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff, 0xfe, 0x07, 0x1f, 0x80, 
	0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff, 0xfc, 0x0f, 0x0f, 0xc0, 0x00, 0x1f, 0xff, 0xff, 
	0xff, 0xff, 0xf8, 0xff, 0xfc, 0x0f, 0x0f, 0xc0, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff, 
	0xf8, 0x0f, 0x07, 0xe0, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff, 0xf8, 0x1f, 0x07, 0xe0, 
	0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xff, 0xf8, 0x1f, 0x03, 0xf0, 0x00, 0x1f, 0xff, 0xff, 
	0xff, 0xff, 0xf8, 0xff, 0xf0, 0x00, 0xff, 0xf0, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x7f, 
	0xf0, 0x00, 0xff, 0xf0, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x7f, 0xe0, 0x00, 0xff, 0xf8, 
	0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x7f, 0xe0, 0x00, 0xff, 0xf8, 0x00, 0x3f, 0xff, 0xff, 
	0xff, 0xff, 0xfc, 0x7f, 0xc0, 0x00, 0xff, 0xfc, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x7f, 
	0xc0, 0xff, 0x00, 0xfc, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x7f, 0x80, 0xff, 0x00, 0x7e, 
	0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x7f, 0x81, 0xff, 0x00, 0x7e, 0x00, 0x3f, 0xff, 0xff, 
	0xff, 0xff, 0xfc, 0x7f, 0x01, 0xff, 0x00, 0x3f, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x7f, 
	0x03, 0xff, 0x00, 0x3f, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x3f, 0x03, 0xff, 0x00, 0x1f, 
	0x80, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x3e, 0x03, 0xff, 0x00, 0x1f, 0x80, 0x7f, 0xff, 0xff, 
	0xff, 0xff, 0xfe, 0x3e, 0x07, 0xff, 0x00, 0x1f, 0xc0, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x3c, 
	0x07, 0xff, 0x00, 0x0f, 0xc0, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0x00, 0x00, 
	0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x3f, 0xff, 0xff, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 
	0xff, 0xff, 0xfe, 0x0f, 0xff, 0xff, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0x03, 
	0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x81, 0xff, 0xff, 0x00, 0x00, 
	0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x7f, 0xff, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xf8, 0x1f, 0xff, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 
	0x07, 0xff, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x81, 0xff, 0x00, 0x01, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0xff, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xf0, 0x3f, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xfc, 0x0f, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x03, 0x00, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xf8, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x7f, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

void GuiHandler::Logo() {
	display->drawBitmap(1, 1, angular, 96, 64, WHITE);
}

GuiHandler *GuiHandler::setTitle(string _title) {
	this->title = new string(_title);
	return this;
}
GuiHandler *GuiHandler::setArtist(string _artist) {
	this->artist = new string(_artist);
	return this;
}
GuiHandler *GuiHandler::setAlbum(string _album) {
	this->album = new string(_album);
	return this;
}

GuiHandler *GuiHandler::refreshTitle(){
	this->refreshRow(POS_TITLE, title, RED);
	return this;
}

GuiHandler *GuiHandler::refreshArtist(){
	this->refreshRow(POS_ARTIST, artist, YELLOW);	
	return this;
}

GuiHandler *GuiHandler::refreshAlbum(){
	this->refreshRow(POS_ALBUM, album, CYAN);
	return this;
}


GuiHandler *GuiHandler::scrollLine(string *line) {
	display->ScrollSet(12,0,display->TFTHEIGHT,0,10);
	display->scroll(line);
	return this;
}	

GuiHandler *GuiHandler::refreshScreen(){
	refreshTitle();
	refreshArtist();
	return refreshAlbum();
	 
}

void GuiHandler::refreshRow(int16_t posx, string *datdata, color_t color){
	display->clearWindow(0, posx, display->width(), posx + INTERLINE);
	display->setCursor(0, posx + 2);
	display->setTextColor(color);
	display->setTextSize(1);
	display->setTextWrap(false);
	char *newStr = strdup(datdata->c_str());
	println(newStr);
	free(newStr);
}

void GuiHandler::println (char* text){
	while(*text != 0) {
		display->write(*text);
		text++;
	}
}


/*
void GuiHandler::testFastLines() {

}

void GuiHandler::testLines() {
	int           x1, y1, x2, y2,
				w = display->width(),
				h = display->height();

	display->clearScreen();
	uint16_t color = RED;

	x1 = y1 = 0;
	y2    = h - 1;
	for (x2 = 0; x2 < w; x2 += 6) display->drawLine(x1, y1, x2, y2, color);
	x2    = w - 1;
	for (y2 = 0; y2 < h; y2 += 6) display->drawLine(x1, y1, x2, y2, color);

	vTaskDelay(500);
	display->clearScreen();

	x1    = w - 1;
	y1    = 0;
	y2    = h - 1;
	for (x2 = 0; x2 < w; x2 += 6) display->drawLine(x1, y1, x2, y2, color);
	x2    = 0;
	for (y2 = 0; y2 < h; y2 += 6) display->drawLine(x1, y1, x2, y2, color);

	vTaskDelay(500);
	display->clearScreen();

	x1    = 0;
	y1    = h - 1;
	y2    = 0;
	for (x2 = 0; x2 < w; x2 += 6) display->drawLine(x1, y1, x2, y2, color);
	x2    = w - 1;
	for (y2 = 0; y2 < h; y2 += 6) display->drawLine(x1, y1, x2, y2, color);

	vTaskDelay(500);
	display->clearScreen();

	x1    = w - 1;
	y1    = h - 1;
	y2    = 0;
	for (x2 = 0; x2 < w; x2 += 6) display->drawLine(x1, y1, x2, y2, color);
	x2    = 0;
	for (y2 = 0; y2 < h; y2 += 6) display->drawLine(x1, y1, x2, y2, color);


}

void GuiHandler::testRectangles(int alpha) {
	uint16_t x, y, x1, y1, x2, y2, x3, y3, r=25;

	x = x0 + sin(alpha*0.0174532925) * r;
	y = y0 - cos(alpha*0.0174532925) * r;

	alpha += 90;
	x1 = x0 + sin(alpha*0.0174532925) * r;
	y1 = y0 - cos(alpha*0.0174532925) * r;

	alpha += 90;
	x2 = x0 + sin(alpha*0.0174532925) * r;
	y2 = y0 - cos(alpha*0.0174532925) * r;

	alpha += 90;
	x3 = x0 + sin(alpha*0.0174532925) * r;
	y3 = y0 - cos(alpha*0.0174532925) * r;

	display->drawLine(x, y, x1, y1, GREEN);
	display->drawLine(x1, y1, x2, y2, GREEN);
	display->drawLine(x2, y2, x3, y3, GREEN);
	display->drawLine(x3, y3, x, y, GREEN);
}

void GuiHandler::testRectangles2(int alpha) {
	uint16_t x, y, x1, y1, x2, y2, x3, y3, r=20;

	x = x0 + sin(alpha*0.0174532925) * r;
	y = y0 - cos(alpha*0.0174532925) * r;

	x1 = x0 + sin(alpha*0.0174532925) * r;
	y1 = y0 + cos(alpha*0.0174532925) * r;

	x2 = x0 - sin(alpha*0.0174532925) * r;
	y2 = y0 + cos(alpha*0.0174532925) * r;

	x3 = x0 - sin(alpha*0.0174532925) * r;
	y3 = y0 - cos(alpha*0.0174532925) * r;

	display->drawLine(x, y, x1, y1, BLUE);
	display->drawLine(x1, y1, x2, y2, BLUE);
	display->drawLine(x2, y2, x3, y3, BLUE);
	display->drawLine(x3, y3, x, y, BLUE);
}

void GuiHandler::testBox3d() {
	uint16_t x, y, r=20, alpha=45;

	x = x0-r + sin(alpha*0.0174532925) * r;
	y = y0-r+10 - cos(alpha*0.0174532925) * r;

	display->fillRect(x0-r, y0-r+10, 2*r, 2*r, RED);
	for(int i=0; i<r*2;i++){
		display->drawLine(x0-r+i, y0-r+10, x+i, y, BLUE);
		display->drawLine(x0+r, y0-r+i+10, x+2*r, y+i, GREEN);
	}

}*/
